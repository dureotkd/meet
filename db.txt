
CREATE DATABASE meet;

DROP TABLE `member`;
CREATE TABLE MEMBER(
    id INT(10) UNSIGNED NOT NULL PRIMARY KEY AUTO_INCREMENT,
    regDate DATETIME NOT NULL,
    updateDate DATETIME,
    email CHAR(100) NOT NULL,
    `name` CHAR(20) NOT NULL,
    nickname CHAR(50) NOT NULL,
    loginPw CHAR(255) NOT NULL,
    mailStatus TINYINT(1) UNSIGNED NOT NULL
);

SELECT * FROM MEMBER;

DROP TABLE prison;

CREATE TABLE article (
	id INT(10) UNSIGNED NOT NULL PRIMARY KEY AUTO_INCREMENT,
	regDate DATETIME NOT NULL,
	updateDate DATETIME,
	title CHAR(50) NOT NULL,
	`body` TEXT NOT NULL,
	memberId INT(10) UNSIGNED NOT NULL,
	displayStatus TINYINT(1) UNSIGNED NOT NULL
);

SELECT * FROM article
WHERE displayStatus = 1
ORDER BY id DESC;



CREATE TABLE 


SELECT * FROM article;

CREATE TABLE `file` (
	    id INT(10) UNSIGNED NOT NULL PRIMARY KEY AUTO_INCREMENT,
	    regDate DATETIME,
	    updateDate DATETIME,
	    delDate DATETIME,
		delStatus TINYINT(1) UNSIGNED NOT NULL DEFAULT 0,
		relTypeCode CHAR(50) NOT NULL,
		relId INT(10) UNSIGNED NOT NULL,
	    originFileName VARCHAR(100) NOT NULL,
	    fileExt CHAR(10) NOT NULL,
	    typeCode CHAR(20) NOT NULL,
	    type2Code CHAR(20) NOT NULL,
	    fileSize INT(10) UNSIGNED NOT NULL,
	    fileExtTypeCode CHAR(10) NOT NULL,
	    fileExtType2Code CHAR(10) NOT NULL,
	    fileNo TINYINT(2) UNSIGNED NOT NULL,
	    `body` LONGBLOB
	);
SELECT * FROM FILE;


CREATE TABLE attr (
    id INT(10) UNSIGNED NOT NULL PRIMARY KEY AUTO_INCREMENT,
    regDate DATETIME NOT NULL,
    updateDate DATETIME NOT NULL,
    `name` CHAR(100) NOT NULL UNIQUE,
    `value` TEXT NOT NULL
);

ALTER TABLE `cateItem` ADD COLUMN `updateDate` DATETIME NOT NULL AFTER `regDate`; 

# attr 테이블에서 name 을 4가지 칼럼으로 나누기
ALTER TABLE `attr` DROP COLUMN `name`,
ADD COLUMN `relTypeCode` CHAR(20) NOT NULL AFTER `updateDate`,
ADD COLUMN `relId` INT(10) UNSIGNED NOT NULL AFTER `relTypeCode`,
ADD COLUMN `typeCode` CHAR(30) NOT NULL AFTER `relId`,
ADD COLUMN `type2Code` CHAR(30) NOT NULL AFTER `typeCode`,
CHANGE `value` `value` TEXT CHARSET utf8mb4 COLLATE utf8mb4_unicode_ci NOT NULL AFTER `type2Code`,
DROP INDEX `name`; 


# 중복변수 생성금지. 변수찾는 속도 최적화 UNIQUE
ALTER TABLE `attr` ADD UNIQUE INDEX (`relTypeCode`, `relId`, `typeCode`, `type2Code`); 


## 특정 조건을 만족하는 회원 또는 게시물(기타 데이터)를 빠르게 찾기 위해서
ALTER TABLE `attr` ADD INDEX (`relTypeCode`, `typeCode`, `type2Code`); 


SELECT * FROM attr;
SELECT * FROM MEMBER;

ALTER TABLE `member` ADD COLUMN introduce TEXT NOT NULL;

SELECT M.*,
M.nickname AS extra__writer
FROM MEMBER AS M
WHERE id = 2;
SELECT COUNT(*) AS
cnt 
FROM MEMBER
WHERE email = 'dureotkd123@naver.com';


SELECT COUNT(*) AS
cnt
FROM MEMBER
WHERE nickname = '케빈';

SELECT * FROM `file`;
SELECT * FROM `member`;


DROP TABLE articleReply;
CREATE TABLE articleReply (
	id INT(10) UNSIGNED NOT NULL PRIMARY KEY AUTO_INCREMENT,
	regDate DATETIME NOT NULL,
	updateDate DATETIME,
	`body` TEXT NOT NULL,
	articleId INT(10) UNSIGNED NOT NULL,
	memberId INT(10) UNSIGNED NOT NULL,
	displayStatus TINYINT(1) UNSIGNED NOT NULL
);







CREATE TABLE Friend(
	id INT(10) UNSIGNED NOT NULL PRIMARY KEY AUTO_INCREMENT,
	regDate DATETIME NOT NULL,
	followId INT (10) UNSIGNED NOT NULL,
	followerId  INT (10) UNSIGNED NOT NULL
)

## 친구 추가 중복 금지


ALTER TABLE `Friend` ADD UNIQUE INDEX ( followId , followerId );
SELECT * FROM `friend`;
TRUNCATE friend;


## DB MEMBER 테이블에 세션 ID 와 유효시간 설정 컬럼 만들기
ALTER TABLE `member` ADD COLUMN sessionKey VARCHAR(50) NOT NULL DEFAULT 'none';
ALTER TABLE `member` ADD COLUMN sessionLimit TIMESTAMP;

SELECT * FROM `member`;
SELECT * FROM `articleReply`;
SELECT * FROM `file`;
SELECT * FROM `ar
truncate `attr`;
select * from `attr`;

SELECT * FROM member
WHERE sessionKey = 'B7DA4F97E5101FAE151F85216DB70E9B';





ALTER TABLE `member` ADD COLUMN delStatus TINYINT(1) NOT NULL;

ALTER TABLE `member` ADD COLUMN delRegDate DATETIME;


CREATE TABLE message (
    id INT(10) UNSIGNED NOT NULL PRIMARY KEY AUTO_INCREMENT,
    regDate DATETIME NOT NULL,
    delStatus TINYINT(1) UNSIGNED NOT NULL,
    displayStatus TINYINT(1) UNSIGNED NOT NULL,
    delRegDate DATETIME,
    fromId INT(10) UNSIGNED NOT NULL,
    toId INT(10) UNSIGNED NOT NULL,
    `body` TEXT NOT NULL
);



SELECT MSG.*,
SND.nickname AS extra__fromMemberName
FROM message AS MSG
INNER JOIN `member` AS SND
ON MSG.fromId = SND.id
WHERE MSG.toId = 10
AND MSG.delStatus = 0
ORDER BY id ASC

ALTER TABLE message ADD COLUMN readStatus TINYINT(1) UNSIGNED NOT NULL;

readStatus

SELECT *
FROM `member`

SELECT * FROM `message`;



SELECT * FROM `member`;
SELECT * FROM `message`;







